<%- include('../partials/header') %>

<div class="container watercolor-butterfly" style="margin-top: 3rem; margin-bottom: 4rem;">
  <div style="max-width: 900px; margin: 0 auto;">
    <!-- Back Button -->
    <a href="/events" style="color: #CE325B; margin-bottom: 2rem; display: inline-block;">
      <%= t('events.detail.back') %>
    </a>

    <!-- Messages -->
    <% if (req.query.message === 'event_full') { %>
      <div class="alert alert-error" style="margin-bottom: 2rem;">
        <strong>Event is Full</strong>
        <p style="margin-top: 0.5rem;">This event has reached its maximum capacity. Registration is no longer available.</p>
      </div>
    <% } else if (req.query.message === 'event_past') { %>
      <div class="alert alert-error" style="margin-bottom: 2rem;">
        <strong>Event Has Passed</strong>
        <p style="margin-top: 0.5rem;">This event has already occurred. Registration is no longer available.</p>
      </div>
    <% } else if (req.query.message === 'already_registered') { %>
      <div class="alert alert-info" style="margin-bottom: 2rem;">
        <strong>Already Registered</strong>
        <p style="margin-top: 0.5rem;">You are already registered for this event.</p>
      </div>
    <% } else if (req.query.message === 'signup_success') { %>
      <div class="alert alert-success" style="margin-bottom: 2rem;">
        <strong>Registration Successful!</strong>
        <p style="margin-top: 0.5rem;">You have been successfully registered for this event.</p>
      </div>
    <% } %>

    <!-- Event Card -->
    <div class="card">
      <% if (event.image_url) { %>
        <img src="<%= event.image_url %>" alt="<%= event.title %>" style="width: 100%; max-height: 400px; object-fit: cover; border-radius: var(--border-radius) var(--border-radius) 0 0; margin: -1.5rem -1.5rem 2rem -1.5rem;">
      <% } %>

      <h1 class="card-title" style="font-size: 2.5rem;"><%= event.title %></h1>

      <!-- Event Meta Info -->
      <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin: 1.5rem 0; padding: 1.5rem; background-color: var(--sage-soft); border-radius: var(--border-radius); color: var(--text-color);">
        <div style="flex: 1; min-width: 200px;">
          <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;"><%= t('events.detail.dateTime') %></div>
          <div><%= new Date(event.event_date_time_start).toLocaleDateString(locale, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></div>
          <div style="color: var(--text-secondary);"><%= new Date(event.event_date_time_start).toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit' }) %></div>
        </div>

        <div style="flex: 1; min-width: 200px;">
          <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;"><%= t('events.detail.location') %></div>
          <div><%= event.event_location || t('events.detail.locationTbd') %></div>
        </div>
        <% if (event.event_capacity) { %>
          <div style="flex: 1; min-width: 200px;">
            <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;"><%= t('events.detail.capacity') %></div>
            <div><%= event.event_capacity %> <%= t('events.detail.participants') %></div>
          </div>
        <% } %>
      </div>
      <div style="margin: 2rem 0;">
        <h2 style="font-size: 1.5rem; margin-bottom: 1rem;"><%= t('events.detail.about') %></h2>
        <p style="line-height: 1.8; color: var(--text-secondary);">
          <%= event.description || t('events.detail.descriptionDefault') %>
        </p>
      </div>
      <div style="border-top: 1px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
        <% if (isPast) { %>
          <div class="alert alert-secondary">
            <strong>This event has passed</strong>
            <p style="margin-top: 0.5rem;">Registration is no longer available for this event.</p>
          </div>
        <% } else if (!isLoggedIn) { %>
          <div class="alert alert-info">
            <strong><%= t('events.detail.loginRequired') %></strong>
            <p style="margin-top: 0.5rem;"><%= t('events.detail.loginMsg') %></p>
          </div>
          <div style="display: flex; gap: 1rem;">
            <a href="/login" class="btn btn-primary btn-lg"><%= t('events.detail.login') %></a>
            <a href="/signup" class="btn btn-outline btn-lg"><%= t('events.detail.createAccount') %></a>
          </div>
        <% } else if (isRegistered) { %>
          <div class="alert alert-success">
            <strong><%= t('events.detail.registered') %></strong>
            <p style="margin-top: 0.5rem;"><%= t('events.detail.registeredMsg') %></p>
          </div>
          <a href="/user/events" class="btn btn-secondary"><%= t('events.detail.viewMyEvents') %></a>
        <% } else { %>
          <h3 style="margin-bottom: 1rem;"><%= t('events.detail.registerTitle') %></h3>
          <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
            <%= t('events.detail.registerMsg') %>
          </p>
          <form action="/events/<%= event.event_occurance_id %>/signup" method="POST">
            <button type="submit" class="btn btn-primary btn-lg">
              <%= t('events.detail.registerBtn') %>
            </button>
          </form>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
