<%- include('../partials/header') %>

<div class="container watercolor-left" style="margin-top: 3rem; margin-bottom: 4rem;">
  <!-- Back Button -->
  <a href="/admin/participants" style="color: #CE325B; margin-bottom: 2rem; display: inline-block;">
    ‚Üê Back to Participants
  </a>

  <!-- User Info Card -->
  <div class="card" style="margin-bottom: 2rem;">
    <h1 class="card-title" style="font-size: 2rem;"><%= participant.name %></h1>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; padding: 1.5rem; background-color: var(--sage-soft); border-radius: var(--border-radius); color: var(--text-color);">
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Email</div>
        <div><%= participant.email %></div>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Role</div>
        <div>
          <% if (participant.role === 'admin') { %>
            <span class="badge badge-danger">Admin</span>
          <% } else { %>
            <span class="badge badge-primary">User</span>
          <% } %>
        </div>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Login Count</div>
        <div><%= participant.login_count || 0 %> times</div>
      </div>
    </div>

    <!-- Alerts -->
    <% if (success) { %>
      <div class="alert alert-success">
        <%= success %>
      </div>
    <% } %>

    <% if (error) { %>
      <div class="alert alert-error">
        <%= error %>
      </div>
    <% } %>

    <!-- Change Password Section -->
    <div style="border-top: 1px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
      <h2 style="font-size: 1.5rem; margin-bottom: 1rem;">Change User Password</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
        Use this form to set a new password for this user. The password will be securely hashed.
      </p>

      <form action="/admin/participants/<%= participant.id %>/change-password" method="POST" style="max-width: 500px;">
        <div class="form-group">
          <label for="newPassword" class="form-label">New Password</label>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            class="form-input"
            placeholder="Enter new password"
            required
            minlength="6"
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirm New Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            class="form-input"
            placeholder="Re-enter new password"
            required
            minlength="6"
          />
        </div>

        <button type="submit" class="btn btn-primary">
          Update Password
        </button>
      </form>
    </div>
  </div>

  <!-- Registered Events Section -->
  <div class="card">
    <h2 class="card-title" style="font-size: 1.75rem;">Registered Events</h2>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
      Events this user has signed up for.
    </p>

    <% if (userEvents && userEvents.length > 0) { %>
      <div style="overflow-x: auto;">
        <table class="table">
          <thead>
            <tr>
              <th>Event Name</th>
              <th>Date</th>
              <th>Location</th>
              <th>Registered On</th>
            </tr>
          </thead>
          <tbody>
            <% userEvents.forEach(event => { %>
              <tr>
                <td><strong><%= event.title %></strong></td>
                <td>
                  <%= new Date(event.date).toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  }) %>
                </td>
                <td><%= event.location || 'TBD' %></td>
                <td>
                  <%= new Date(event.registered_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  }) %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div style="margin-top: 1rem; text-align: center; color: var(--text-secondary);">
        Total: <%= userEvents.length %> event<%= userEvents.length !== 1 ? 's' : '' %>
      </div>
    <% } else { %>
      <div style="text-align: center; padding: 3rem 2rem; background-color: var(--sage-soft); border-radius: var(--border-radius); color: var(--text-color);">
        <p style="color: var(--text-secondary);">This user has not registered for any events yet.</p>
      </div>
    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>
