<%- include('../partials/header') %>

<div class="container watercolor-rose" style="margin-top: 3rem; margin-bottom: 4rem;">
  <!-- Back Button and Actions -->
  <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; align-items: center;">
    <a href="/admin/participants" style="color: #CE325B;">
      <%= t('admin.participantDetail.back') %>
    </a>
    <a href="/admin/participants/<%= participant.id %>/edit" class="btn btn-primary">Edit User</a>
    <form action="/admin/participants/<%= participant.id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
      <button type="submit" class="btn btn-danger">Delete User</button>
    </form>
  </div>

  <!-- User Info Card -->
  <div class="card" style="margin-bottom: 2rem;">
    <h1 class="card-title" style="font-size: 2rem;"><%= participant.name %></h1>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; padding: 1.5rem; background-color: var(--sage-soft); border-radius: var(--border-radius); color: var(--text-color);">
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;"><%= t('admin.participantDetail.email') %></div>
        <div><%= participant.email %></div>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;"><%= t('admin.participantDetail.role') %></div>
        <div>
          <% if (participant.role === 'admin') { %>
            <span class="badge badge-danger"><%= t('admin.participantDetail.role.admin') %></span>
          <% } else { %>
            <span class="badge badge-primary"><%= t('admin.participantDetail.role.user') %></span>
          <% } %>
        </div>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;"><%= t('admin.participantDetail.logins') %></div>
        <div><%= participant.login_count || 0 %> <%= t('admin.participantDetail.logins.times') %></div>
      </div>
    </div>

    <!-- Alerts -->
    <% if (success) { %>
      <div class="alert alert-success">
        <%= success %>
      </div>
    <% } %>

    <% if (error) { %>
      <div class="alert alert-error">
        <%= error %>
      </div>
    <% } %>

    <!-- Change Password Section -->
    <div style="border-top: 1px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
      <h2 style="font-size: 1.5rem; margin-bottom: 1rem;"><%= t('admin.participantDetail.password.title') %></h2>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
        <%= t('admin.participantDetail.password.copy') %>
      </p>

      <form action="/admin/participants/<%= participant.id %>/change-password" method="POST" style="max-width: 500px;">
        <div class="form-group">
          <label for="newPassword" class="form-label"><%= t('admin.participantDetail.password.new') %></label>
          <input
            type="password"
            id="newPassword"
            name="newPassword"
            class="form-input"
            placeholder="Enter new password"
            required
            minlength="6"
          />
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label"><%= t('admin.participantDetail.password.confirm') %></label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            class="form-input"
            placeholder="Re-enter new password"
            required
            minlength="6"
          />
        </div>

        <button type="submit" class="btn btn-primary">
          <%= t('admin.participantDetail.password.submit') %>
        </button>
      </form>
    </div>
  </div>

  <!-- Registered Events Section -->
  <div class="card">
    <h2 class="card-title" style="font-size: 1.75rem;"><%= t('admin.participantDetail.events.title') %></h2>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
      <%= t('admin.participantDetail.events.copy') %>
    </p>

    <% if (userEvents && userEvents.length > 0) { %>
      <div style="overflow-x: auto;">
        <table class="table">
          <thead>
            <tr>
              <th><%= t('admin.participantDetail.events.name') %></th>
              <th><%= t('admin.participantDetail.events.date') %></th>
              <th><%= t('admin.participantDetail.events.location') %></th>
              <th><%= t('admin.participantDetail.events.registered') %></th>
            </tr>
          </thead>
          <tbody>
            <% userEvents.forEach(event => { %>
              <tr>
                <td><strong><%= event.title %></strong></td>
                <td>
                  <%= new Date(event.date).toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  }) %>
                </td>
                <td><%= event.location || t('admin.events.location.tbd') %></td>
                <td>
                  <%= new Date(event.registered_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  }) %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div style="margin-top: 1rem; text-align: center; color: var(--text-secondary);">
        <%= t('admin.participantDetail.events.total') %>: <%= userEvents.length %> event<%= userEvents.length !== 1 ? 's' : '' %>
      </div>
    <% } else { %>
      <div style="text-align: center; padding: 3rem 2rem; background-color: var(--sage-soft); border-radius: var(--border-radius); color: var(--text-color);">
        <p style="color: var(--text-secondary);"><%= t('admin.participantDetail.events.empty') %></p>
      </div>
    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>
