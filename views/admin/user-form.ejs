<%- include('../partials/header') %>

<div class="container" style="margin-top: 3rem; margin-bottom: 3rem;">
  <div style="max-width: 700px; margin: 0 auto;">
    <!-- Back Button -->
    <a href="/admin/participants" style="color: #CE325B; margin-bottom: 2rem; display: inline-block;">
      ‚Üê Back to Participants
    </a>

    <div class="card">
      <h1 class="card-title"><%= user ? 'Edit User' : 'Create New User' %></h1>

      <% if (error) { %>
        <div class="alert alert-error" style="margin-bottom: 1.5rem;">
          <%= error %>
        </div>
      <% } %>

      <form action="<%= user ? `/admin/participants/${user.id}/edit` : '/admin/participants/new/user' %>" method="POST">
        <div class="form-group">
          <label for="name" class="form-label">Full Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            class="form-input"
            value="<%= user ? user.name : '' %>"
            required
          />
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email Address *</label>
          <input
            type="email"
            id="email"
            name="email"
            class="form-input"
            value="<%= user ? user.email : '' %>"
            required
          />
        </div>

        <% if (!user) { %>
          <div class="form-group">
            <label for="password" class="form-label">Password *</label>
            <input
              type="password"
              id="password"
              name="password"
              class="form-input"
              placeholder="Enter initial password"
              required
            />
            <p class="form-helper">Minimum 6 characters</p>
          </div>
        <% } %>

        <div class="form-group">
          <label for="role" class="form-label">Role *</label>
          <select id="role" name="role" class="form-select" required>
            <option value="user" <%= user && user.role === 'user' ? 'selected' : '' %>>User</option>
            <option value="admin" <%= user && user.role === 'admin' ? 'selected' : '' %>>Admin</option>
          </select>
          <p class="form-helper">
            <strong>User:</strong> Can view events, enroll in programs, submit surveys<br>
            <strong>Admin:</strong> Can manage all users, events, programs, and view analytics
          </p>
        </div>

        <% if (user) { %>
          <div style="background-color: var(--sage-soft); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
            <p style="color: var(--text-color); margin: 0; font-size: 0.9rem;">
              <strong>Note:</strong> To change the password, use the "Change Password" option on the user detail page.
            </p>
          </div>
        <% } %>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button type="submit" class="btn btn-primary btn-lg">
            <%= user ? 'Update User' : 'Create User' %>
          </button>
          <a href="/admin/participants" class="btn btn-outline btn-lg">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
