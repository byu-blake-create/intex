<%- include('../partials/header') %>

<div class="container watercolor-blush" style="margin-top: 3rem; margin-bottom: 4rem;">
  <div style="margin-bottom: 2rem;">
    <a href="/programs" class="btn btn-outline"><%= t('programs.detail.back') %></a>
  </div>

  <div class="card">
    <h1 style="font-size: 2.5rem; margin-bottom: 2rem;"><%= program.title %></h1>

    <!-- Program Details -->
    <div class="grid grid-2" style="margin-bottom: 2rem;">
      <% if (program.age_range) { %>
        <div>
          <h3 style="color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; margin-bottom: 0.5rem;"><%= t('programs.detail.age') %></h3>
          <p style="font-size: 1.1rem;"><%= program.age_range %></p>
        </div>
      <% } %>

      <% if (program.schedule) { %>
        <div>
          <h3 style="color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; margin-bottom: 0.5rem;"><%= t('programs.detail.schedule') %></h3>
          <p style="font-size: 1.1rem;"><%= program.schedule %></p>
        </div>
      <% } %>

      <% if (program.fee) { %>
        <div>
          <h3 style="color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; margin-bottom: 0.5rem;"><%= t('programs.detail.fee') %></h3>
          <p style="font-size: 1.1rem;">$<%= program.fee %></p>
        </div>
      <% } %>
    </div>

    <!-- Description -->
    <% if (program.description) { %>
      <div style="margin-bottom: 2rem;">
        <h3 style="margin-bottom: 1rem;"><%= t('programs.detail.about') %></h3>
        <p style="line-height: 1.8; white-space: pre-wrap;"><%= program.description %></p>
      </div>
    <% } %>

    <!-- Additional Info -->
    <% if (program.additional_info) { %>
      <div style="background-color: var(--sage-soft); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 2rem; color: var(--text-color);">
        <h3 style="margin-bottom: 1rem;"><%= t('programs.detail.info') %></h3>
        <p style="white-space: pre-wrap;"><%= program.additional_info %></p>
      </div>
    <% } %>

    <!-- Enrollment Section -->
    <div style="border-top: 2px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
      <% if (isLoggedIn) { %>
        <% if (isEnrolled) { %>
          <div style="background-color: #d4edda; color: #155724; padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 2rem; border: 1px solid #c3e6cb;">
            <strong><%= t('programs.detail.enrolled.title') %></strong>
            <p style="margin-top: 0.5rem;"><%= t('programs.detail.enrolled.copy') %></p>
          </div>
        <% } else { %>
          <h3 style="margin-bottom: 1rem;"><%= t('programs.detail.join') %></h3>
          <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
            <%= t('programs.detail.join.copy') %>
          </p>
          <form action="/programs/<%= program.id %>/enroll" method="POST">
            <button type="submit" class="btn btn-primary btn-lg"><%= t('programs.detail.join.cta') %></button>
          </form>
        <% } %>
      <% } else { %>
        <div style="background-color: var(--sage-soft); padding: 2rem; border-radius: var(--border-radius); text-align: center; color: var(--text-color);">
          <h3 style="margin-bottom: 1rem;"><%= t('programs.detail.login.title') %></h3>
          <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
            <%= t('programs.detail.login.copy') %>
          </p>
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <a href="/login?redirect=/programs/<%= program.id %>" class="btn btn-primary"><%= t('programs.detail.login') %></a>
            <a href="/signup?redirect=/programs/<%= program.id %>" class="btn btn-secondary"><%= t('programs.detail.signup') %></a>
          </div>
        </div>
      <% } %>
    </div>

    <!-- Support Section -->
    <div style="border-top: 2px solid var(--border-color); padding-top: 2rem; margin-top: 2rem;">
      <h3 style="margin-bottom: 1rem;"><%= t('programs.detail.support.title') %></h3>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
        <%= t('programs.detail.support.copy') %>
      </p>
      <a href="https://givebutter.com/EllaRises" target="_blank" class="btn btn-secondary"><%= t('programs.detail.support.cta') %></a>
    </div>
  </div>

  <!-- Messages -->
  <% if (typeof query !== 'undefined' && query.message) { %>
    <% if (query.message === 'enrollment_success') { %>
      <div style="background-color: #d4edda; color: #155724; padding: 1rem; border-radius: var(--border-radius); margin-top: 2rem; border: 1px solid #c3e6cb;">
        <%= t('programs.detail.message.success') %> <%= program.title %>!
      </div>
    <% } else if (query.message === 'already_enrolled') { %>
      <div style="background-color: #fff3cd; color: #856404; padding: 1rem; border-radius: var(--border-radius); margin-top: 2rem; border: 1px solid #ffeaa7;">
        <%= t('programs.detail.message.already') %>
      </div>
    <% } else if (query.message === 'error') { %>
      <div style="background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: var(--border-radius); margin-top: 2rem; border: 1px solid #f5c6cb;">
        <%= t('programs.detail.message.error') %>
      </div>
    <% } %>
  <% } %>
</div>

<%- include('../partials/footer') %>
